# ç¼–è¯‘å‰æ£€æŸ¥æ¸…å• âœ…

åœ¨æ¨é€åˆ° GitHub æˆ–æœ¬åœ°æ‰“åŒ…ä¹‹å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ç›®ã€‚

## ğŸ“‹ å¿…é¡»æ£€æŸ¥çš„æ–‡ä»¶

### 1. TypeScript é…ç½®

#### `tsconfig.json`
```json
{
  "compilerOptions": { ... },
  "include": ["src"]
  // âœ… ç¡®ä¿æ²¡æœ‰ "references" å­—æ®µ
}
```

#### `tsconfig.node.json`
```json
{
  "compilerOptions": {
    // âœ… ç¡®ä¿æ²¡æœ‰ "composite": true
    "module": "CommonJS",          // âœ… å¿…é¡»æ˜¯ CommonJS
    "moduleResolution": "node",    // âœ… å¿…é¡»æ˜¯ node
    "outDir": "dist-electron",
    "rootDir": "electron",
    ...
  }
}
```

### 2. Package.json é…ç½®

```json
{
  // âœ… ç¡®ä¿æ²¡æœ‰ "type": "module"
  "main": "dist-electron/main.js",
  "scripts": {
    "build": "tsc && vite build && tsc -p tsconfig.node.json",
    "postinstall": "electron-builder install-app-deps"  // âœ… å¿…é¡»æœ‰
  },
  "build": {
    "asarUnpack": [
      "node_modules/better-sqlite3/**/*"  // âœ… å¿…é¡»æœ‰
    ]
  }
}
```

### 3. é…ç½®æ–‡ä»¶è¯­æ³•

#### `postcss.config.js`
```javascript
module.exports = {  // âœ… ä½¿ç”¨ module.exportsï¼Œä¸æ˜¯ export default
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

#### `tailwind.config.js`
```javascript
module.exports = {  // âœ… ä½¿ç”¨ module.exportsï¼Œä¸æ˜¯ export default
  darkMode: ['class'],
  content: [...],
  ...
}
```

### 4. .npmrc æ–‡ä»¶

```ini
# å¼ºåˆ¶ä½¿ç”¨é¢„æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶
build-from-source=false
```

### 5. GitHub Actions å·¥ä½œæµ

`.github/workflows/build.yml`:
- âœ… ä½¿ç”¨ `actions/checkout@v4`ï¼ˆä¸æ˜¯ v3ï¼‰
- âœ… ä½¿ç”¨ `actions/setup-node@v4`ï¼ˆä¸æ˜¯ v3ï¼‰
- âœ… ä½¿ç”¨ `actions/upload-artifact@v4`ï¼ˆä¸æ˜¯ v3ï¼‰
- âœ… åŒ…å« "Build application code" æ­¥éª¤
- âœ… åŒ…å« "Verify build output" æ­¥éª¤

---

## ğŸ§ª æœ¬åœ°éªŒè¯æ­¥éª¤

åœ¨æ¨é€åˆ° GitHub ä¹‹å‰ï¼Œè¯·åœ¨æœ¬åœ°æ‰§è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

### æ­¥éª¤ 1: æ¸…ç†æ—§æ–‡ä»¶
```bash
rm -rf dist dist-electron release node_modules/.cache
```

### æ­¥éª¤ 2: é‡æ–°æ„å»º
```bash
npm run build
```

### æ­¥éª¤ 3: éªŒè¯è¾“å‡º
```bash
# æ£€æŸ¥ dist-electron ç›®å½•
ls -lh dist-electron/

# åº”è¯¥çœ‹åˆ°ï¼š
# database.js  (çº¦ 11KB)
# main.js      (çº¦ 11KB)
# preload.js   (çº¦ 1.7KB)
```

å¦‚æœçœ‹ä¸åˆ°è¿™äº›æ–‡ä»¶ï¼Œ**ä¸è¦æ¨é€åˆ° GitHub**ï¼

### æ­¥éª¤ 4: éªŒè¯æ–‡ä»¶å†…å®¹
```bash
# æ£€æŸ¥ main.js æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ JavaScript
head -20 dist-electron/main.js

# åº”è¯¥çœ‹åˆ° "use strict" å’Œ CommonJS ä»£ç 
```

### æ­¥éª¤ 5: æµ‹è¯•å¼€å‘æ¨¡å¼
```bash
npm run dev
```

åº”ç”¨åº”è¯¥èƒ½æ­£å¸¸å¯åŠ¨å¹¶å‘ç°æœåŠ¡å™¨ã€‚

### æ­¥éª¤ 6: æµ‹è¯•æ‰“åŒ…ï¼ˆå¯é€‰ï¼‰
```bash
npm run package
```

æ£€æŸ¥ `release/` ç›®å½•æ˜¯å¦æœ‰è¾“å‡ºæ–‡ä»¶ã€‚

---

## ğŸš¨ å¸¸è§é”™è¯¯æ£€æŸ¥

### âŒ é”™è¯¯ 1: dist-electron/main.js ä¸å­˜åœ¨

**åŸå› **: tsconfig é…ç½®é”™è¯¯

**æ£€æŸ¥**:
- `tsconfig.json` ä¸­æ˜¯å¦æœ‰ `"references"`ï¼Ÿ
- `tsconfig.node.json` ä¸­æ˜¯å¦æœ‰ `"composite": true`ï¼Ÿ

### âŒ é”™è¯¯ 2: PostCSS æˆ– Tailwind è¯­æ³•é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Unexpected token 'export'`

**æ£€æŸ¥**:
- `postcss.config.js` å’Œ `tailwind.config.js` æ˜¯å¦ä½¿ç”¨ `module.exports`ï¼Ÿ
- `package.json` ä¸­æ˜¯å¦æœ‰ `"type": "module"`ï¼Ÿ

### âŒ é”™è¯¯ 3: Windows better-sqlite3 ç¼–è¯‘å¤±è´¥

**é”™è¯¯ä»£ç **: `npm error code 3221225786`

**æ£€æŸ¥**:
- `.npmrc` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿ
- `package.json` ä¸­ `build.asarUnpack` æ˜¯å¦åŒ…å« better-sqlite3ï¼Ÿ

### âŒ é”™è¯¯ 4: macOS dmg-license é”™è¯¯

**åŸå› **: åœ¨ Linux ç¯å¢ƒå°è¯•ç¼–è¯‘ macOS åº”ç”¨

**è§£å†³**: åªèƒ½é€šè¿‡ GitHub Actions ç¼–è¯‘ï¼Œä¸èƒ½åœ¨ ClackyAI æˆ– Linux ä¸Šç¼–è¯‘

---

## âœ… æ¨é€å‰æœ€ç»ˆç¡®è®¤

åœ¨æ‰§è¡Œ `git push` ä¹‹å‰ï¼Œç¡®è®¤ï¼š

- [ ] âœ… æœ¬åœ° `npm run build` æˆåŠŸ
- [ ] âœ… `dist-electron/main.js` å­˜åœ¨ä¸”å¤§å°çº¦ 11KB
- [ ] âœ… `npm run dev` å¯ä»¥æ­£å¸¸è¿è¡Œ
- [ ] âœ… æ‰€æœ‰ TypeScript é…ç½®æ­£ç¡®
- [ ] âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶ä½¿ç”¨ CommonJS è¯­æ³•
- [ ] âœ… GitHub Actions å·¥ä½œæµä½¿ç”¨ v4 ç‰ˆæœ¬
- [ ] âœ… package.json ä¸­æœ‰ `asarUnpack` é…ç½®

---

## ğŸ¯ æ¨é€åˆ° GitHub

ç¡®è®¤ä»¥ä¸Šæ‰€æœ‰é¡¹ç›®åï¼š

```bash
# 1. æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# 2. æäº¤æ›´æ”¹
git commit -m "ä¿®å¤æ‰€æœ‰ç¼–è¯‘é—®é¢˜ - å‡†å¤‡å‘å¸ƒ v1.0.3"

# 3. æ¨é€åˆ°ä¸»åˆ†æ”¯
git push origin main

# 4. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag v1.0.3

# 5. æ¨é€æ ‡ç­¾ï¼ˆè§¦å‘ GitHub Actionsï¼‰
git push origin v1.0.3
```

---

## ğŸ“Š GitHub Actions ç›‘æ§

æ¨é€æ ‡ç­¾åï¼š

1. è®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å/server-manager/actions`
2. æŸ¥çœ‹ "Build All Platforms" å·¥ä½œæµ
3. é¢„è®¡ç¼–è¯‘æ—¶é—´ï¼š10-15 åˆ†é’Ÿ
4. æˆåŠŸåä¸‹è½½ Artifactsï¼š
   - `linux-build`
   - `windows-build`
   - `macos-build`

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

### æœ¬åœ°æ„å»ºæˆåŠŸ
```
âœ“ 1589 modules transformed.
dist/index.html                   0.72 kB â”‚ gzip:  0.40 kB
dist/assets/index-D3phULsD.css   18.58 kB â”‚ gzip:  4.12 kB
dist/assets/index-Cr5sYmGG.js   189.61 kB â”‚ gzip: 59.69 kB
âœ“ built in 3.91s
```

### GitHub Actions æˆåŠŸ
- âœ… æ‰€æœ‰ä¸‰ä¸ªå¹³å°ç¼–è¯‘é€šè¿‡
- âœ… Artifacts ä¸Šä¼ æˆåŠŸ
- âœ… æ— ä»»ä½•çº¢è‰²é”™è¯¯

**æ­å–œï¼ä½ çš„åº”ç”¨ç¼–è¯‘å®Œå…¨æˆåŠŸï¼** ğŸš€
