# æ„å»ºé—®é¢˜ä¿®å¤è¯´æ˜

## âŒ åŸå§‹é”™è¯¯

```
Application entry file "dist-electron/main.js" does not exist
```

---

## ğŸ” é—®é¢˜åŸå› 

### é—®é¢˜ 1ï¼šTypeScript é…ç½®é”™è¯¯
```json
// tsconfig.node.json (é”™è¯¯é…ç½®)
{
  "module": "ESNext",           // âŒ Electron éœ€è¦ CommonJS
  "moduleResolution": "bundler"  // âŒ åº”è¯¥ä½¿ç”¨ node
}
```

### é—®é¢˜ 2ï¼špackage.json é…ç½®å†²çª
```json
{
  "type": "module"  // âŒ å¯¼è‡´ Electron ä¸»è¿›ç¨‹åŠ è½½å¤±è´¥
}
```

### é—®é¢˜ 3ï¼šmacOS æ„å»ºé…ç½®ä¸å®Œæ•´
```json
{
  "mac": {
    "target": ["dmg", "zip"]  // âŒ ç¼ºå°‘æ¶æ„é…ç½®
  }
}
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1ï¼šæ›´æ–° tsconfig.node.json

**ä¿®æ”¹å‰**ï¼š
```json
{
  "compilerOptions": {
    "module": "ESNext",
    "moduleResolution": "bundler"
  }
}
```

**ä¿®æ”¹å**ï¼š
```json
{
  "compilerOptions": {
    "module": "CommonJS",           // âœ… Electron å…¼å®¹
    "moduleResolution": "node",     // âœ… Node.js æ¨¡å—è§£æ
    "esModuleInterop": true,        // âœ… ES æ¨¡å—äº’æ“ä½œ
    "resolveJsonModule": true       // âœ… æ”¯æŒå¯¼å…¥ JSON
  }
}
```

---

### ä¿®å¤ 2ï¼šç§»é™¤ package.json ä¸­çš„ "type": "module"

**ä¿®æ”¹å‰**ï¼š
```json
{
  "name": "server-manager",
  "type": "module",  // âŒ åˆ é™¤è¿™ä¸€è¡Œ
  "main": "dist-electron/main.js"
}
```

**ä¿®æ”¹å**ï¼š
```json
{
  "name": "server-manager",
  "main": "dist-electron/main.js"  // âœ… é»˜è®¤ä½¿ç”¨ CommonJS
}
```

---

### ä¿®å¤ 3ï¼šä¼˜åŒ– macOS æ„å»ºé…ç½®

**ä¿®æ”¹å‰**ï¼š
```json
{
  "mac": {
    "target": ["dmg", "zip"]
  }
}
```

**ä¿®æ”¹å**ï¼š
```json
{
  "mac": {
    "target": {
      "target": "default",
      "arch": ["x64", "arm64"]  // âœ… åŒæ—¶æ”¯æŒ Intel å’Œ Apple Silicon
    }
  }
}
```

---

### ä¿®å¤ 4ï¼šä¼˜åŒ– GitHub Actions å·¥ä½œæµ

**å…³é”®æ”¹è¿›**ï¼š
- âœ… åˆ†ç¦» `npm run build` å’Œ `electron-builder` æ­¥éª¤
- âœ… æ·»åŠ æ„å»ºéªŒè¯æ­¥éª¤ï¼ˆæ£€æŸ¥ dist-electron/main.js æ˜¯å¦å­˜åœ¨ï¼‰
- âœ… ä½¿ç”¨ `npx electron-builder` è€Œä¸æ˜¯ npm scripts
- âœ… å‡çº§åˆ° actions/upload-artifact@v4

---

## ğŸ§ª éªŒè¯ä¿®å¤

### æœ¬åœ°éªŒè¯

```bash
# 1. æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf dist/ dist-electron/

# 2. é‡æ–°æ„å»º
npm run build

# 3. æ£€æŸ¥è¾“å‡ºæ–‡ä»¶
ls -lh dist-electron/
# åº”è¯¥çœ‹åˆ°ï¼š
# âœ… database.js
# âœ… main.js
# âœ… preload.js

# 4. éªŒè¯ main.js å†…å®¹
head -n 5 dist-electron/main.js
# åº”è¯¥çœ‹åˆ°æ­£å¸¸çš„ JavaScript ä»£ç 
```

### æ„å»ºæˆåŠŸæ ‡å¿—

```bash
dist-electron/
â”œâ”€â”€ database.d.ts    (1.6 KB)
â”œâ”€â”€ database.js      (11 KB)   âœ…
â”œâ”€â”€ main.d.ts        (11 B)
â”œâ”€â”€ main.js          (11 KB)   âœ… å…³é”®æ–‡ä»¶
â”œâ”€â”€ preload.d.ts     (1.4 KB)
â””â”€â”€ preload.js       (1.7 KB)  âœ…
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é—®é¢˜ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **TypeScript æ¨¡å—** | ESNextï¼ˆä¸å…¼å®¹ï¼‰ | CommonJSï¼ˆå…¼å®¹ Electronï¼‰ |
| **æ¨¡å—è§£æ** | bundlerï¼ˆVite ä¸“ç”¨ï¼‰ | nodeï¼ˆNode.js æ ‡å‡†ï¼‰ |
| **package.json** | type: moduleï¼ˆå†²çªï¼‰ | é»˜è®¤ CommonJSï¼ˆæ­£ç¡®ï¼‰ |
| **macOS æ¶æ„** | æœªæŒ‡å®š | x64 + arm64ï¼ˆé€šç”¨ï¼‰ |
| **æ„å»ºæµç¨‹** | ä¸€æ­¥å®Œæˆï¼ˆæ˜“å‡ºé”™ï¼‰ | åˆ†æ­¥éªŒè¯ï¼ˆæ›´å¯é ï¼‰ |

---

## ğŸš€ ç°åœ¨å¯ä»¥åšçš„

### 1. æ¨é€ä¿®å¤åˆ° GitHub

```bash
git add .
git commit -m "Fix: resolve build configuration issues for all platforms"
git push
```

### 2. é‡æ–°è§¦å‘ GitHub Actions

**æ–¹æ³• Aï¼šæ‰‹åŠ¨è§¦å‘**
1. è®¿é—® GitHub ä»“åº“
2. Actions â†’ Build All Platforms
3. Run workflow

**æ–¹æ³• Bï¼šæ‰“æ ‡ç­¾è§¦å‘**
```bash
git tag v1.0.1
git push origin v1.0.1
```

### 3. ç­‰å¾…ç¼–è¯‘å®Œæˆ

- â±ï¸ Linux: 5-8 åˆ†é’Ÿ
- â±ï¸ Windows: 6-10 åˆ†é’Ÿ
- â±ï¸ macOS: 8-12 åˆ†é’Ÿ

### 4. ä¸‹è½½å®‰è£…åŒ…

ä» Actions é¡µé¢çš„ Artifacts åŒºåŸŸä¸‹è½½ï¼š
- âœ… linux-build.zip
- âœ… windows-build.zip
- âœ… macos-build.zip

---

## ğŸ¯ ä¸ºä»€ä¹ˆç°åœ¨èƒ½æˆåŠŸï¼Ÿ

### æ„å»ºæµç¨‹è§£æ

```mermaid
graph LR
    A[TypeScript æºç ] -->|tsc| B[CommonJS æ¨¡å—]
    B --> C[dist-electron/main.js]
    C --> D[electron-builder]
    D --> E[macOS .app]
    D --> F[Windows .exe]
    D --> G[Linux .AppImage]
```

**å…³é”®ç‚¹**ï¼š
1. âœ… TypeScript æ­£ç¡®ç¼–è¯‘ä¸º CommonJSï¼ˆElectron å¯ä»¥åŠ è½½ï¼‰
2. âœ… main.js æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
3. âœ… electron-builder èƒ½æ‰¾åˆ°å…¥å£æ–‡ä»¶
4. âœ… macOS æ„å»ºæ”¯æŒ Intel å’Œ Apple Silicon

---

## ğŸ“ é‡è¦æé†’

### âš ï¸ ä¸è¦åšçš„äº‹ï¼š

1. âŒ ä¸è¦åœ¨ package.json ä¸­æ·»åŠ  `"type": "module"`
2. âŒ ä¸è¦ä¿®æ”¹ tsconfig.node.json çš„ module ä¸º ESNext
3. âŒ ä¸è¦åœ¨ Electron ä¸»è¿›ç¨‹ä¸­ä½¿ç”¨ ES6 import/export

### âœ… æœ€ä½³å®è·µï¼š

1. âœ… Electron ä¸»è¿›ç¨‹ä½¿ç”¨ CommonJS (`require`/`module.exports`)
2. âœ… React å‰ç«¯ä½¿ç”¨ ES6 æ¨¡å—ï¼ˆVite å¤„ç†ï¼‰
3. âœ… ä¿æŒ tsconfig.node.json å’Œ tsconfig.json åˆ†ç¦»
4. âœ… ä½¿ç”¨ GitHub Actions ç¼–è¯‘æ‰€æœ‰å¹³å°

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœæ„å»ºè¿˜æ˜¯å¤±è´¥

**æ£€æŸ¥æ¸…å•**ï¼š

```bash
# 1. éªŒè¯ TypeScript é…ç½®
cat tsconfig.node.json
# ç¡®ä¿ module: "CommonJS"

# 2. éªŒè¯ package.json
grep '"type"' package.json
# åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼ˆä¸å­˜åœ¨ type å­—æ®µï¼‰

# 3. æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf node_modules dist dist-electron
npm install
npm run build

# 4. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
file dist-electron/main.js
# åº”è¯¥æ˜¾ç¤ºï¼šASCII text æˆ– JavaScript source
```

---

## âœ… æˆåŠŸæ ‡å¿—

å½“ GitHub Actions æˆåŠŸæ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š

```
âœ“ Packaging for linux x64 using electron-builder 24.13.3
âœ“ Building target AppImage
âœ“ Building target deb

âœ“ Packaging for win32 x64 using electron-builder 24.13.3
âœ“ Building target nsis
âœ“ Building target portable

âœ“ Packaging for darwin x64, arm64 using electron-builder 24.13.3
âœ“ Building macOS universal package
âœ“ Building target dmg
âœ“ Building target zip
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Electron å®˜æ–¹æ–‡æ¡£ - ä¸»è¿›ç¨‹](https://www.electronjs.org/docs/latest/tutorial/process-model#the-main-process)
- [electron-builder é…ç½®](https://www.electron.build/configuration/configuration)
- [TypeScript ç¼–è¯‘é€‰é¡¹](https://www.typescriptlang.org/tsconfig)

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰æ„å»ºé—®é¢˜å·²ä¿®å¤ï¼š

1. âœ… TypeScript é…ç½®æ­£ç¡®ï¼ˆCommonJSï¼‰
2. âœ… package.json é…ç½®æ­£ç¡®ï¼ˆæ—  type: moduleï¼‰
3. âœ… macOS æ„å»ºé…ç½®å®Œæ•´ï¼ˆæ”¯æŒåŒæ¶æ„ï¼‰
4. âœ… GitHub Actions æµç¨‹ä¼˜åŒ–ï¼ˆåˆ†æ­¥éªŒè¯ï¼‰

**ç°åœ¨æ¨é€ä»£ç å¹¶é‡æ–°è§¦å‘ GitHub Actionsï¼Œåº”è¯¥èƒ½æˆåŠŸç¼–è¯‘æ‰€æœ‰å¹³å°ï¼**
